<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        >
        <meta
            http-equiv="X-UA-Compatible"
            content="ie=edge"
        >
        <title>sw</title>
        <link rel="stylesheet" href="/pages/index/index.css">
    </head>

    <body>
        <h1>Lego Star Wars gallery</h1>
        <div id="root"></div>
        <img src="https://mermaid-js.github.io/mermaid/img/header.png">
        <script src="/pages/index/app.js"></script>
        <script>
            if ('serviceWorker' in navigator) {
                // 监听版本变化, 一变化就刷新页面, 及时安装最新版 sw
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    alert('controllerchange');
                    window.location.reload();
                })
                window.addEventListener('load', function () {
                    if (!navigator.serviceWorker.controller) {
                        try {
                            navigator.serviceWorker.register('/sw.js', { scope: '/' })
                                .then(function (registration) {
                                    // Registration was successful
                                    // scope 默认 '/', 即: 'http://localhost:9999/'
                                    // 执行到这里时, sw 或是已经安装进入激活状态, 或是unregister后装进入安装状态
                                    // 若安装过 刷新 去缓存刷新都会保持在 active 状态
                                    // 去缓存刷新, sw 缓存失效, 重新缓存, 请求走服务端请求, 当再次刷新进入页面时, sw 缓存生效
                                    // 普通刷新, sw 缓存生效
                                    console.log('ServiceWorker registration successful with scope: ', registration);
                                    if (registration.installing) {
                                        console.log('Service worker installing');
                                    } else if (registration.waiting) {
                                        console.log('Service worker installed');
                                    } else if (registration.active) {
                                        console.log(caches, '================================');
                                        console.log('Service worker active');
                                    }
                                })
                                .catch(e => {
                                    console.log(e.messag);
                                });
                        } catch (err) {
                            throw Error(err)
                        }
                    }
                });
            }
        </script>
    </body>

</html>
